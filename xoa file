.

ğŸ” Dry-run â€” chá»‰ LIá»†T KÃŠ, CHÆ¯A XOÃ
# 1) In ra cÃ¡c thÆ° má»¥c site-packages hiá»‡n táº¡i (venv/user)
python - <<'PY'
import site, sys
print("Python:", sys.executable)
print("site-packages:", *site.getsitepackages(), sep="\n  ")
print("user-site    :", site.getusersitepackages())
PY

# 2) Liá»‡t kÃª cÃ¡c gÃ³i pip cÃ i HÃ”M NAY (dá»±a trÃªn *.dist-info / *.egg-info má»›i táº¡o)
TODAY="$(date +%Y-%m-%d)"
for SP in $(python - <<'PY'
import site; print(*site.getsitepackages(), site.getusersitepackages(), sep="\n")
PY
); do
  [ -d "$SP" ] || continue
  echo "=== Scan: $SP ==="
  # cÃ¡c metadata thÆ° má»¥c gÃ³i má»›i hÃ´m nay
  find "$SP" -maxdepth 1 -type d \( -name "*.dist-info" -o -name "*.egg-info" \) -newermt "$TODAY" -print |
  while read D; do
    # láº¥y tÃªn gÃ³i tá»« METADATA náº¿u cÃ³ (chÃ­nh xÃ¡c hÆ¡n tÃ¡ch tÃªn-thá»§-cÃ´ng)
    PKG=$(awk -F': ' '/^Name: /{print $2; exit}' "$D/METADATA" 2>/dev/null || basename "$D" | sed -E 's/\.(dist|egg)-info$//; s/-[0-9].*$//')
    echo "  will uninstall: $PKG   (from $D)"
  done
done

# 3) Liá»‡t kÃª cache/tá»‡p táº£i dá»Ÿ cá»§a pip trong HÃ”M NAY
echo "=== pip cache today ==="
find ~/.cache/pip -type f -newermt "$TODAY" -print 2>/dev/null || true

echo "=== partial downloads today (~/.whl.part, .part, .tmp) ==="
find ~ -type f -newermt "$TODAY" \( -name "*.whl.part" -o -name "*.part" -o -name "*.tmp" \) -print 2>/dev/null || true

ğŸ§¨ Do-it â€” Gá»  & XOÃ THáº¬T (chá»‰ hÃ´m nay)
A) Gá»¡ cÃ¡c gÃ³i pip Ä‘Æ°á»£c cÃ i hÃ´m nay
TODAY="$(date +%Y-%m-%d)"
for SP in $(python - <<'PY'
import site; print(*site.getsitepackages(), site.getusersitepackages(), sep="\n")
PY
); do
  [ -d "$SP" ] || continue
  find "$SP" -maxdepth 1 -type d \( -name "*.dist-info" -o -name "*.egg-info" \) -newermt "$TODAY" -print |
  while read D; do
    PKG=$(awk -F': ' '/^Name: /{print $2; exit}' "$D/METADATA" 2>/dev/null || basename "$D" | sed -E 's/\.(dist|egg)-info$//; s/-[0-9].*$//')
    # gá»¡ báº±ng pip Ä‘á»ƒ xÃ³a sáº¡ch file Ä‘i kÃ¨m
    echo "Uninstalling $PKG ..."
    python -m pip uninstall -y "$PKG" || true
  done
done


CÃ¡ch nÃ y Ä‘á»c METADATA/Name Ä‘á»ƒ láº¥y Ä‘Ãºng tÃªn gÃ³i (an toÃ n hÆ¡n tÃ¡ch chuá»—i).
Náº¿u trÆ°á»›c Ä‘Ã³ cÃ i bá»‹ dá»Ÿ dang (khÃ´ng cÃ³ METADATA), pip cÃ³ thá»ƒ khÃ´ng gá»¡ Ä‘Æ°á»£c. Khi Ä‘Ã³ chuyá»ƒn sang bÆ°á»›c B.

B) XÃ³a thá»§ cÃ´ng tÃ n dÆ° hÃ´m nay (gÃ³i cÃ i dá»Ÿ, build táº¡m, partial)
# XÃ³a thÆ° má»¥c package/metadata má»›i táº¡o hÃ´m nay trong site-packages (tÃ n dÆ° do cÃ i dá»Ÿ)
for SP in $(python - <<'PY'
import site; print(*site.getsitepackages(), site.getusersitepackages(), sep="\n")
PY
); do
  [ -d "$SP" ] || continue
  find "$SP" -maxdepth 1 -type d -newermt "$TODAY" \
       \( -name "*.dist-info" -o -name "*.egg-info" -o -name "[A-Za-z0-9_]*" \) -exec rm -rf {} + 2>/dev/null
done

# XÃ³a thÆ° má»¥c build/dist/egg-info táº¡o hÃ´m nay trong HOME
find ~ -type d -newermt "$TODAY" \( -name "build" -o -name "dist" -o -name "*.egg-info" \) -exec rm -rf {} +

# XÃ³a file gÃ³i (.whl/.tar/.zip/.pth) táº£i hÃ´m nay
find ~ -type f -newermt "$TODAY" \( -name "*.whl" -o -name "*.tar*" -o -name "*.zip" -o -name "*.pth" \) -delete 2>/dev/null

# XÃ³a tá»‡p táº£i dá»Ÿ hÃ´m nay (*.part, *.tmp, *.whl.part)
find ~ -type f -newermt "$TODAY" \( -name "*.whl.part" -o -name "*.part" -o -name "*.tmp" \) -delete 2>/dev/null

# Dá»n cache pip (xÃ³a má»i cache â€” an toÃ n)
python -m pip cache purge

C) (TÃ¹y chá»n) Dá»n cache apt hÃ´m nay (KHÃ”NG gá»¡ cÃ i Ä‘áº·t apt)
sudo find /var/cache/apt/archives -type f -newermt "$(date +%Y-%m-%d)" -delete

D) Kiá»ƒm tra láº¡i
df -h
python - <<'PY'
import pkgutil, sys
print("Python:", sys.executable)
print("Example check â€” torch present? :", bool(pkgutil.find_loader('torch')))
PY

Ghi
